---
name: 模板编辑器颜色和红头
overview: 在模板管理编辑器中添加字体颜色、字体背景颜色选择器功能，以及红头文件（标准/简约模式）插入功能，参考演训文档编辑器的实现方式。
todos:
  - id: copy-color-picker
    content: 复制 ColorPicker.vue 到 template/editor/components 目录
    status: completed
  - id: copy-colored-hr
    content: 复制 ColoredHorizontalRule.ts 到 template/editor/extensions 目录
    status: completed
  - id: update-editor-extensions
    content: 在 MarkdownEditor.vue 中添加 TextStyle、Color、ColoredHorizontalRule 扩展
    status: completed
  - id: add-color-toolbar
    content: 在工具栏中添加字体颜色和背景颜色选择器
    status: completed
  - id: add-redheader-dropdown
    content: 在工具栏中添加红头文件下拉菜单（标准/简约）
    status: completed
  - id: add-redheader-insert
    content: 实现红头文件内容插入逻辑
    status: completed
  - id: add-redline-style
    content: 添加红色横线的 CSS 样式
    status: completed
---

# 模板编辑器增强：颜色选择器与红头文件功能

## 需求分析

### 需求1：字体颜色和字体背景颜色

参考演训文档 `StartToolbar.vue` 中的 `ColorPicker` 组件实现，在模板管理编辑器工具栏中添加相同功能。

### 需求2：红头文件功能

根据图片 `ht1.jpg`（标准模式）和 `ht2.jpg`（简约模式）的效果：

**标准模式内容**：

- 右上角文件号（000001）
- 密级标签（机密/特急）
- 红色居中大标题（XXXXXXX文件）
- 红色分隔横线
- 文件编号和签发人信息行

**简约模式内容**：

- 红色居中大标题（XXXXXXX文件）
- 红色分隔横线

## 实现方案

### 1. 复制组件和扩展文件

从演训文档目录复制到模板编辑器目录：

- `ColorPicker.vue` -> `src/views/template/editor/components/ColorPicker.vue`
- `ColoredHorizontalRule.ts` -> `src/views/template/editor/extensions/ColoredHorizontalRule.ts`

### 2. 修改 MarkdownEditor.vue

#### 2.1 添加 Tiptap 扩展

```typescript
// 新增导入
import { TextStyle, FontSize } from '@tiptap/extension-text-style'
import { Color } from '@tiptap/extension-color'
import { ColoredHorizontalRule } from '../extensions/ColoredHorizontalRule'
import ColorPicker from './ColorPicker.vue'

// 在 extensions 配置中添加
;(TextStyle,
  FontSize.configure({ types: ['textStyle'] }),
  Color.configure({ types: ['textStyle'] }),
  ColoredHorizontalRule) // 替换默认的 horizontalRule
```

#### 2.2 添加工具栏按钮

在工具栏格式化区域后添加：

- 字体颜色选择器（使用 ColorPicker 组件）
- 字体背景颜色选择器（使用 ColorPicker 组件）
- 红头文件下拉按钮（标准/简约两个选项）

#### 2.3 实现红头文件插入逻辑

```typescript
// 标准红头文件 HTML
const standardRedHeader = `
<p style="text-align: right; font-size: 14px;">000001</p>
<p style="font-size: 14px;">机密</p>
<p style="font-size: 14px;">特急</p>
<p style="text-align: center; color: #ff0000; font-size: 32px; font-weight: bold; font-family: 方正小标宋简体, SimSun, serif;">XXXXXXX文件</p>
<hr data-line-color="red" class="red-line">
<p>XX〔2025〕01 号<span style="float: right;">签发人:</span></p>
`

// 简约红头文件 HTML
const simpleRedHeader = `
<p style="text-align: center; color: #ff0000; font-size: 32px; font-weight: bold; font-family: 方正小标宋简体, SimSun, serif;">XXXXXXX文件</p>
<hr data-line-color="red" class="red-line">
`
```

### 3. 添加红色横线样式

在 MarkdownEditor.vue 的 CSS 中添加：

```scss
hr {
  &.red-line,
  &[data-line-color='red'] {
    border-top-color: #ff0000;
    border-top-width: 2px;
  }
}
```

## 文件变更清单

- 新建：`src/views/template/editor/components/ColorPicker.vue`
- 新建：`src/views/template/editor/extensions/ColoredHorizontalRule.ts`
- 修改：`src/views/template/editor/components/MarkdownEditor.vue`
